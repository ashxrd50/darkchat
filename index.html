<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Anon Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#0a0a0a;color:#fff;font-family:monospace}
#chat{height:calc(100vh - 70px);overflow:auto;padding:10px}
.msg{margin-bottom:8px}
.name{color:#888;font-size:12px}
#input{height:70px;display:flex;gap:10px;padding:10px;border-top:1px solid #222}
input{flex:1;background:#000;border:1px solid #333;color:#fff;padding:10px}
button{background:#111;border:1px solid #333;color:#fff;padding:0 15px}
</style>
</head>

<body>

<div id="chat"></div>

<div id="input">
  <input id="msg" placeholder="mesaj yaz">
  <button onclick="send()">GÃ¶nder</button>
</div>

<script>
/* ==== SUPABASE ==== */
const SUPABASE_URL = "https://dhwqtanvouvonspqwawm.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRod3F0YW52b3V2b25zcHF3YXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNTk2MDEsImV4cCI6MjA4MzYzNTYwMX0.DHJ9Grc75evWPhNVFmT_xOnEDKK4ssKjW1TWVtPnBKI";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ==== USER ==== */
const names=["root","ghost","null","cipher","shadow","void"];
const username = names[Math.floor(Math.random()*names.length)]+"#"+Math.floor(Math.random()*900+100);

/* ==== DRAW ==== */
function draw(u,t){
  const d=document.createElement("div");
  d.className="msg";
  d.innerHTML=`<div class="name">${u}</div><div>${t}</div>`;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

/* ==== LOAD ==== */
async function load(){
  const {data,error} = await sb
    .from("messages")
    .select("username,text")
    .order("id");

  if(error){alert(error.message);return;}

  chat.innerHTML="";
  data.forEach(m=>draw(m.username,m.text));
}

/* ==== SEND ==== */
async function send(){
  const v=msg.value.trim();
  if(!v) return;

  const {error} = await sb
    .from("messages")
    .insert({username:username,text:v});

  if(error){alert(error.message);return;}

  msg.value="";
}

/* ==== REALTIME ==== */
sb.channel("chat")
.on("postgres_changes",
{event:"INSERT",schema:"public",table:"messages"},
p=>draw(p.new.username,p.new.text)
)
.subscribe();

load();
</script>

</body>
</html>

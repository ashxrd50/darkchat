<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Anon Chat</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{margin:0;background:#050505;color:#fff;font-family:monospace}
#chat{height:80vh;overflow:auto;padding:10px}
input,button{background:#000;color:#fff;border:1px solid #333;padding:10px}
</style>
</head>
<body>

<div id="chat"></div>
<input id="msg" placeholder="mesaj yaz">
<button onclick="send()">send</button>

<script>
const sb = supabase.createClient(
  "https://dhwqtanvouvonspqwawm.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRod3F0YW52b3V2b25zcHF3YXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNTk2MDEsImV4cCI6MjA4MzYzNTYwMX0.DHJ9Grc75evWPhNVFmT_xOnEDKK4ssKjW1TWVtPnBKI"
);

const user = "anon#" + Math.floor(Math.random()*999);

function draw(n,t){
  chat.innerHTML += `<div><b>${n}</b>: ${t}</div>`;
}

async function load(){
  const {data} = await sb.from("messages").select("*").order("id");
  chat.innerHTML="";
  data.forEach(m=>draw(m.name,m.text));
}

async function send(){
  const v = msg.value.trim();
  if(!v) return;

  const {error} = await sb.from("messages").insert({
    name: user,
    text: v
  });

  if(error) alert(error.message);
  msg.value="";
}

sb.channel("c")
.on("postgres_changes",
  {event:"INSERT",schema:"public",table:"messages"},
  p=>draw(p.new.name,p.new.text)
)
.subscribe();

load();
</script>
</body>
</html>

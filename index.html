<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>anonymous://chat</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box}
body{margin:0;background:#050505;color:#9ca3af;font-family:Courier New,monospace}
#top{
  height:45px;background:#000;border-bottom:1px solid #111;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 15px;font-size:13px
}
#chat{
  height:calc(100vh - 110px);
  overflow-y:auto;padding:10px
}
.msg{margin-bottom:14px}
.name{font-size:12px;color:#6b7280}
.text{font-size:14px;color:#e5e7eb;line-height:1.4}
#input{
  height:65px;background:#000;border-top:1px solid #111;
  display:flex;gap:10px;padding:10px
}
input{
  flex:1;background:#050505;border:1px solid #222;
  color:#fff;padding:10px;font-family:inherit
}
button{
  background:#111;border:1px solid #333;
  color:#9ca3af;padding:0 16px;cursor:pointer
}
</style>
</head>

<body>

<div id="top">
  <div>anonymous://chat</div>
  <div id="room">#global</div>
</div>

<div id="chat"></div>

<div id="input">
  <input id="message" placeholder="type message..." autocomplete="off">
  <button onclick="send()">send</button>
</div>

<script>
/* üîë SUPABASE */
const SUPABASE_URL = "https://dhwqtanvouvonspqwawm.supabase.co";
const SUPABASE_KEY = "sb_publishable_pWR0L6kTZHHzzaoD2mCWsw_6BVk2DJY";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* üë§ USER */
const names=["root","ghost","null","cipher","void","proxy"];
const user = names[Math.random()*names.length|0] + "#" + (Math.random()*900+100|0);

/* üåç ROOM */
const room = location.hash.replace("#","") || "global";
document.getElementById("room").innerText = "#"+room;

/* üö´ K√úF√úR Fƒ∞LTRESƒ∞ */
const bad=["salak","aptal","k√ºf√ºr"];
function clean(t){
  bad.forEach(w=>t=t.replace(new RegExp(w,"gi"),"***"));
  return t;
}

/* üì• ESKƒ∞ MESAJLAR */
supabase
  .from("messages")
  .select("*")
  .eq("room",room)
  .order("created_at",{ascending:true})
  .then(r=>{
    if(r.data) r.data.forEach(show);
  });

/* üì° REALTIME */
supabase.channel("room-"+room)
  .on("postgres_changes",
    {event:"INSERT",schema:"public",table:"messages"},
    payload=>{
      if(payload.new.room===room)
        show(payload.new);
    }
  ).subscribe();

/* üõ°Ô∏è SPAM */
let last=0;

/* üì§ SEND */
function send(){
  const input=message;
  const now=Date.now();
  if(!input.value.trim())return;
  if(now-last<2000)return; // 2 sn flood
  last=now;

  supabase.from("messages").insert({
    room:room,
    name:user,
    text:clean(input.value)
  });
  input.value="";
}

/* üñ•Ô∏è UI */
function show(d){
  const m=document.createElement("div");
  m.className="msg";
  m.innerHTML=`
    <div class="name">${d.name}</div>
    <div class="text">${d.text}</div>
  `;
  chat.appendChild(m);
  chat.scrollTop=chat.scrollHeight;
}

message.addEventListener("keydown",e=>{
  if(e.key==="Enter")send();
});
</script>

</body>
</html>

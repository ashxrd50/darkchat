<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>anonymous://chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#000;color:#ccc;font-family:monospace}
#top{height:40px;border-bottom:1px solid #111;display:flex;justify-content:space-between;align-items:center;padding:0 10px}
#chat{height:calc(100vh - 100px);overflow-y:auto;padding:10px}
.msg{margin-bottom:10px}
.name{font-size:12px;color:#666}
.text{color:#eee}
#input{height:60px;border-top:1px solid #111;display:flex}
#input input{flex:1;background:#000;color:#fff;border:none;padding:10px}
#input button{background:#111;color:#ccc;border:none;padding:0 20px}
</style>
</head>

<body>

<div id="top">
  <div>anonymous://chat</div>
  <div id="status">connect...</div>
</div>

<div id="chat"></div>

<div id="input">
  <input id="msg" placeholder="type message..." autocomplete="off">
  <button id="sendBtn">send</button>
</div>

<script>
/* ðŸ”§ CONFIG */
const SUPABASE_URL = "https://dhwqtanvouvonspqwawm.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRod3F0YW52b3V2b25zcHF3YXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNTk2MDEsImV4cCI6MjA4MzYzNTYwMX0.DHJ9Grc75evWPhNVFmT_xOnEDKK4ssKjW1TWVtPnBKI";

const supa = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const room = "global";
const user = "anon#" + Math.floor(Math.random()*999);

const chat = document.getElementById("chat");
const status = document.getElementById("status");
const input = document.getElementById("msg");

/* ðŸ§± UI */
function show(m){
  const d = document.createElement("div");
  d.className = "msg";
  d.innerHTML = `<div class="name">${m.name}</div><div class="text">${m.text}</div>`;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

/* ðŸ“¥ LOAD OLD MESSAGES */
supa.from("messages")
  .select("*")
  .eq("room", room)
  .order("created_at", { ascending: true })
  .then(r => {
    if (r.error) {
      alert("SELECT ERROR: " + r.error.message);
      return;
    }
    r.data.forEach(show);
    status.innerText = "connected";
  });

/* âš¡ REALTIME */
supa.channel("room-global")
  .on(
    "postgres_changes",
    { event: "INSERT", schema: "public", table: "messages" },
    payload => show(payload.new)
  )
  .subscribe();

/* ðŸ“¤ SEND */
function send(){
  if(!input.value.trim()) return;

  supa.from("messages").insert({
    room: room,
    name: user,
    text: input.value
  }).then(r=>{
    if(r.error){
      alert("INSERT ERROR: " + r.error.message);
    }
  });

  input.value = "";
}

document.getElementById("sendBtn").onclick = send;
input.addEventListener("keydown", e => { if(e.key==="Enter") send(); });
</script>

</body>
</html>
